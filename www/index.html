<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculadora Redline</title>
    <link rel="icon" href="https://media.discordapp.net/attachments/1252997989622874123/1448463841251033219/LOGO-REDLINE-2_1.png?ex=6943ec52&is=69429ad2&hm=cc5e79e7e69cc89ac3ceef3cb2a3903480f6a8d11d8bf1083185f0445959bc82&=&format=webp&quality=lossless&width=800&height=800" type="image/png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase Compat -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Inter:wght@400;500;600;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, .font-heading { font-family: 'Rajdhani', sans-serif; }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d4d4d8; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #3f3f46; }
        ::-webkit-scrollbar-thumb:hover { background: #ef4444; }
        
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Glassmorphism Styles Adaptáveis */
        .glass { 
            @apply bg-white/80 dark:bg-zinc-900/80 backdrop-blur-md border-b border-zinc-200 dark:border-white/5;
        }
        .glass-card { 
            @apply bg-white/60 dark:bg-zinc-800/40 backdrop-blur-md border border-white/40 dark:border-white/5 shadow-sm;
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.3s ease-out forwards; }

        @keyframes slideDown { from { transform: translate(-50%, -100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        .toast-enter { animation: slideDown 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        red: { 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c', 900: '#7f1d1d' },
                        zinc: { 850: '#1f1f22', 950: '#09090b' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 selection:bg-red-500/30 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        // --- CONFIGURAÇÃO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDv9PiY_5Fs5EU-FX0xtF3IGtXiDv8zfOk",
            authDomain: "redlinecalc.firebaseapp.com",
            projectId: "redlinecalc",
            storageBucket: "redlinecalc.firebasestorage.app",
            messagingSenderId: "1093681985630",
            appId: "1:1093681985630:web:a8f4295efcae6659661ccf",
            measurementId: "G-Q0XEWPZ69L"
        };

        let app, auth, db;
        try {
            if (firebaseConfig.apiKey && firebaseConfig.apiKey !== "SUA_API_KEY_AQUI") {
                app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
            }
        } catch (e) { console.error("Erro Firebase", e); }

        const { useState, useEffect, useMemo } = React;

        const Icons = {
            Sun: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Moon: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Zap: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Calculator: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Settings: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Save: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            Copy: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
            RefreshCw: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            Plus: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14m-7-7v14"/></svg>,
            Minus: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>,
            Check: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Trash: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            LogOut: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
            ChevronRight: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
            Spinner: (p) => <svg {...p} className="animate-spin" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            ArrowUp: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 15-6-6-6 6"/></svg>,
            ArrowDown: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>
        };

        const DEFAULT_DATA = {
            terrestres: {
                order: 0,
                title: "TERRESTRES", partnershipEnabled: true, discountValue: 5000,
                sections: [ { name: "FULL TUNING", enableSelectAll: true, id: "full-tuning", items: [{ name: "MOTOR", value: 40000 }, { name: "FREIO", value: 40000 }, { name: "TRANSMISSÃO", value: 40000 }, { name: "SUSPENSÃO", value: 40000 }, { name: "TURBO", value: 40000 }, { name: "COLETOR DE VÁCUO", value: 50000 }] }, { name: "ESTÉTICA", enableSelectAll: true, id: "estetica", items: [{ name: "COR PRIMÁRIA", value: 25000 }, { name: "COR SECUNDÁRIA", value: 25000 }, { name: "PEROLADO", value: 25000 }, { name: "XENOM", value: 25000 }, { name: "NEON", value: 25000 }, { name: "OUTRAS ESTÉTICAS", value: 25000, counter: true }] }, { name: "RODAS", enableSelectAll: true, id: "rodas", items: [{ name: "RODAS", value: 30000 }, { name: "CUSTOM", value: 20000 }, { name: "COR DA RODA", value: 20000 }, { name: "COR DA FUMAÇA", value: 20000 }] } ]
            },
            aereos: {
                order: 1,
                title: "AÉREOS", partnershipEnabled: true, discountValue: 5000,
                sections: [ { name: "FULL TUNING", enableSelectAll: true, id: "full-tuning-aereos", items: [{ name: "MOTOR", value: 100000 }, { name: "FREIO", value: 100000 }, { name: "TRANSMISSÃO", value: 100000 }, { name: "SUSPENSÃO", value: 100000 }, { name: "TURBO", value: 100000 }] } ]
            },
            especiais: {
                order: 2,
                title: "ESPECIAIS", partnershipEnabled: false, discountValue: 0,
                sections: [ { name: "FULL TUNING", enableSelectAll: true, id: "ft-esp", items: [{ name: "KIT COMPLETO", value: 400000 }] } ]
            },
            excecoes: {
                order: 3,
                title: "EXCEÇÕES", partnershipEnabled: true, discountValue: 5000,
                sections: [ { name: "ITENS", enableSelectAll: true, items: [{ name: "MOTORES", value: 150000 }, { name: "PINTURA", value: 100000 }, { name: "INSULFILM", value: 100000 }, { name: "ESTÉTICA", value: 100000 }] } ]
            },
            exclusivos: {
                order: 4,
                title: "EXCLUSIVOS", partnershipEnabled: false, discountValue: 0,
                sections: [ { name: "VIP SETEMBRO", enableSelectAll: true, items: [{ name: "Suspensão", value: 50000 }, { name: "Neon", value: 50000 }, { name: "Xenon", value: 50000 }] }, { name: "TODOS OS VEÍCULOS", enableSelectAll: true, items: [{ name: "Camber (Inclinação)", value: 50000 }, { name: "Offset (Distância)", value: 50000 }, { name: "Pot’s Bank’s (Fogo)", value: 50000 }, { name: "Wastegate (Som Turbo)", value: 50000 }, { name: "Purgador (Fumaça Capô)", value: 50000 }] } ]
            }
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [activeTab, setActiveTab] = useState('calculator');
            const [vehicleData, setVehicleData] = useState(DEFAULT_DATA);
            const [isOffline, setIsOffline] = useState(false);
            
            // State do Tema
            const [isDarkMode, setIsDarkMode] = useState(() => {
                if (typeof window !== 'undefined') {
                    const saved = localStorage.getItem('theme');
                    return saved ? saved === 'dark' : true;
                }
                return true;
            });

            useEffect(() => {
                const root = document.documentElement;
                if (isDarkMode) {
                    root.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    root.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                }
            }, [isDarkMode]);

            useEffect(() => {
                if (!auth) { setIsOffline(true); return; }
                auth.signInAnonymously().catch(() => {});
                const unsubAuth = auth.onAuthStateChanged(u => { setUser(u); setIsAdmin(u && !u.isAnonymous); });
                const unsubData = db.collection('artifacts').doc('redline-calc').collection('public').doc('vehicle_prices')
                    .onSnapshot(doc => { 
                        if (doc.exists) { 
                            let d = doc.data().config;
                            // Migração Automática: Se não tiver ordem, cria uma
                            const keys = Object.keys(d);
                            keys.forEach((k, i) => {
                                if (d[k].order === undefined) d[k].order = i;
                            });
                            setVehicleData(d); 
                        } 
                    }, () => setIsOffline(true));
                return () => { unsubAuth(); unsubData(); }
            }, []);

            return (
                <div className="min-h-screen flex flex-col pb-20 lg:pb-0 relative overflow-x-hidden transition-colors duration-300">
                    {/* Background Accents (Apenas Dark Mode) */}
                    <div className="fixed top-0 left-0 w-full h-96 bg-red-600/10 rounded-full blur-[128px] -translate-y-1/2 pointer-events-none opacity-0 dark:opacity-100 transition-opacity duration-500"></div>
                    
                    {/* Header */}
                    <header className="glass sticky top-0 z-[100]">
                        <div className="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <img src="https://media.discordapp.net/attachments/1252997989622874123/1448463841251033219/LOGO-REDLINE-2_1.png?ex=6943ec52&is=69429ad2&hm=cc5e79e7e69cc89ac3ceef3cb2a3903480f6a8d11d8bf1083185f0445959bc82&=&format=webp&quality=lossless&width=800&height=800" alt="Logo Redline" className="w-16 h-16 object-contain" />
                                <div>
                                    <h1 className="font-heading font-bold text-base md:text-xl leading-none tracking-wide text-zinc-900 dark:text-white">REDLINE</h1>
                                    <span className="text-[10px] text-zinc-500 dark:text-zinc-400 uppercase tracking-widest font-bold">Calculadora</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <button onClick={() => setIsDarkMode(!isDarkMode)} className="p-2 rounded-lg text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-800 transition-colors">
                                    {isDarkMode ? <Icons.Sun size={18} /> : <Icons.Moon size={18} />}
                                </button>
                                <nav className="flex p-1 bg-zinc-200 dark:bg-zinc-900/50 rounded-lg border border-zinc-300 dark:border-white/5">
                                    <button onClick={() => setActiveTab('calculator')} className={`px-3 md:px-4 py-1.5 rounded-md text-xs font-bold uppercase transition-all flex items-center gap-2 ${activeTab === 'calculator' ? 'bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white shadow-sm' : 'text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-300'}`}>
                                        <Icons.Calculator size={14} /> <span className="hidden sm:inline">Calc</span>
                                    </button>
                                    <button onClick={() => setActiveTab('admin')} className={`px-3 md:px-4 py-1.5 rounded-md text-xs font-bold uppercase transition-all flex items-center gap-2 ${activeTab === 'admin' ? 'bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white shadow-sm' : 'text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-300'}`}>
                                        <Icons.Settings size={14} /> <span className="hidden sm:inline">Admin</span>
                                    </button>
                                </nav>
                            </div>
                        </div>
                    </header>

                    <main className="flex-grow w-full max-w-7xl mx-auto px-4 py-6 z-10">
                        {vehicleData ? (
                            activeTab === 'calculator' ? 
                                <CalculatorView data={vehicleData} /> : 
                                <AdminPanel user={user} isAdmin={isAdmin} currentData={vehicleData} isDarkMode={isDarkMode} />
                        ) : (
                            <div className="flex flex-col items-center justify-center h-[50vh] text-zinc-500 gap-4">
                                <Icons.Spinner size={32}/>
                                <p className="text-xs uppercase tracking-widest font-bold">Carregando Sistema...</p>
                            </div>
                        )}
                    </main>

                    <footer className="flex items-center justify-center py-6 pb-28 lg:pb-6 text-[10px] text-zinc-500 dark:text-zinc-600 uppercase tracking-widest border-t border-zinc-200 dark:border-white/5">
                        &copy; 2025 Redline Calc - System V13
                    </footer>
                </div>
            );
        };

        const CalculatorView = ({ data }) => {
            // Ordenação segura
            const sortedKeys = useMemo(() => {
                return Object.keys(data).sort((a, b) => (data[a].order ?? 0) - (data[b].order ?? 0));
            }, [data]);

            const [selectedType, setSelectedType] = useState(() => sortedKeys[0]);
            const [machineValue, setMachineValue] = useState('');
            const [selectedItems, setSelectedItems] = useState({});
            const [counters, setCounters] = useState({});
            const [copied, setCopied] = useState(null);
            const [toast, setToast] = useState({ show: false, message: '' });

            // Atualiza seleção se chaves mudarem
            useEffect(() => {
                if (!data[selectedType]) setSelectedType(sortedKeys[0]);
            }, [data, sortedKeys]);

            useEffect(() => { setSelectedItems({}); setCounters({}); }, [selectedType]);

            const current = data[selectedType] || { sections: [] };
            const partnershipDiscount = current.discountValue || 0;
            const isPartnershipAllowed = current.partnershipEnabled !== false;

            const totals = useMemo(() => {
                let r = parseFloat(machineValue.replace(/[^0-9,]/g,'').replace(',','.'))||0;
                let n = r, p = r;
                Object.keys(selectedItems).forEach(k => {
                    if(selectedItems[k]) {
                        try {
                            const [type, sIdx, iIdx] = k.split('-');
                            const item = data[type].sections[sIdx].items[iIdx];
                            const c = item.counter ? (counters[k]||0) : 1;
                            n += item.value * c;
                            p += Math.max(0, item.value - partnershipDiscount) * c;
                        } catch(e) {}
                    }
                });
                return { normal: n, part: p };
            }, [selectedItems, counters, machineValue, data, partnershipDiscount]);

            const copy = (val, type) => {
                const el = document.createElement("textarea");
                el.value = `cobrar ${Math.round(val)}`;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                setCopied(type);
                setToast({ show: true, message: `Valor ${type === 'normal' ? 'Total' : 'Parceria'} copiado com sucesso!` });
                setTimeout(() => {
                    setCopied(null);
                    setToast({ show: false, message: '' });
                }, 3000);
            };
            
            const fmt = v => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            return (
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 relative">
                    {/* Toast Notification */}
                    {toast.show && (
                        <div className="fixed top-28 left-1/2 -translate-x-1/2 z-[100] toast-enter w-max max-w-[90%]">
                            <div className="bg-zinc-900 text-white px-6 py-3 rounded-xl shadow-2xl border border-white/10 flex items-center gap-3 backdrop-blur-md">
                                <div className="bg-green-500 rounded-full p-1"><Icons.Check size={14} className="text-white"/></div>
                                <span className="font-bold text-xs md:text-sm tracking-wide">{toast.message}</span>
                            </div>
                        </div>
                    )}

                    {/* Left Column: Selection */}
                    <div className="lg:col-span-8 space-y-6">
                        {/* Category Tabs with Scroll Indicator */}
                        <div className="relative group">
                            <div className="flex overflow-x-auto hide-scroll gap-2 pb-2">
                                {sortedKeys.map(k => (
                                    <button key={k} onClick={() => setSelectedType(k)} 
                                        className={`flex-none px-4 md:px-6 py-2 md:py-3 rounded-xl font-heading font-bold text-[10px] md:text-sm uppercase transition-all tracking-wide border 
                                        ${selectedType === k 
                                            ? 'bg-red-600 border-red-500 text-white shadow-lg shadow-red-900/30' 
                                            : 'bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-zinc-300'}`}>
                                        {data[k].title}
                                    </button>
                                ))}
                                <div className="w-4 flex-none lg:hidden"></div>
                            </div>
                            {/* Scroll Indicator Gradient */}
                            <div className="absolute right-0 top-0 bottom-2 w-12 bg-gradient-to-l from-gray-100 dark:from-zinc-950 to-transparent pointer-events-none lg:hidden"></div>
                        </div>

                        {/* Sections */}
                        <div className="space-y-4 md:space-y-6">
                            {current.sections.map((sec, sIdx) => (
                                <div key={sIdx} className="glass-card rounded-2xl overflow-hidden animate-fade" style={{animationDelay: `${sIdx * 0.1}s`}}>
                                    <div className="px-4 md:px-5 py-3 md:py-4 flex justify-between items-center border-b border-zinc-200 dark:border-white/5 bg-zinc-50/50 dark:bg-white/5">
                                        <h3 className="font-heading font-bold text-xs md:text-lg text-zinc-800 dark:text-white">{sec.name}</h3>
                                        {sec.enableSelectAll !== false && (
                                            <button onClick={() => {
                                                const kBase = `${selectedType}-${sIdx}-`;
                                                const all = sec.items.every((_, i) => selectedItems[`${kBase}${i}`]);
                                                const n = {...selectedItems};
                                                sec.items.forEach((_, i) => n[`${kBase}${i}`] = !all);
                                                setSelectedItems(n);
                                            }} className="text-[8px] md:text-[10px] font-bold uppercase tracking-wider text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-white transition-colors bg-zinc-200 dark:bg-zinc-900/50 px-2 md:px-3 py-1 rounded border border-zinc-300 dark:border-white/5">
                                                {sec.items.every((_, i) => selectedItems[`${selectedType}-${sIdx}-${i}`]) ? 'Desmarcar' : 'Todos'}
                                            </button>
                                        )}
                                    </div>
                                    <div className="divide-y divide-zinc-200 dark:divide-white/5">
                                        {sec.items.map((item, iIdx) => {
                                            const k = `${selectedType}-${sIdx}-${iIdx}`;
                                            const isSel = !!selectedItems[k];
                                            return (
                                                <div key={iIdx} onClick={() => !item.counter && setSelectedItems(p=>({...p, [k]: !p[k]}))} 
                                                    className={`p-3 md:p-4 flex items-center justify-between cursor-pointer transition-all active:scale-[0.99]
                                                    ${isSel ? 'bg-red-500/10 border-l-4 border-l-red-500' : 'hover:bg-zinc-100 dark:hover:bg-white/5 border-l-4 border-l-transparent'}`}>
                                                    <div className="flex items-center gap-3 md:gap-4">
                                                        <div className={`w-5 h-5 md:w-6 md:h-6 rounded-md border flex items-center justify-center transition-all ${isSel ? 'bg-red-600 border-red-500 text-white' : 'border-zinc-300 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800/50 text-transparent'}`}>
                                                            <Icons.Check size={14} strokeWidth={4} />
                                                        </div>
                                                        <span className={`text-xs md:text-lg font-bold ${isSel ? 'text-zinc-900 dark:text-white' : 'text-zinc-500 dark:text-zinc-400'}`}>{item.name}</span>
                                                    </div>
                                                    <div className="flex items-center gap-2 md:gap-4" onClick={e=>e.stopPropagation()}>
                                                        <span className={`text-sm md:text-xl font-mono font-bold ${isSel ? 'text-red-600 dark:text-red-400' : 'text-zinc-600'}`}>{fmt(item.value)}</span>
                                                        {item.counter && (
                                                            <div className="flex items-center bg-zinc-200 dark:bg-zinc-950 rounded-lg p-0.5 md:p-1 border border-zinc-300 dark:border-zinc-800">
                                                                <button onClick={() => { const v = Math.max(0, (counters[k]||0)-1); setCounters(p=>({...p, [k]: v})); setSelectedItems(p=>({...p, [k]: v>0})); }} className="p-1.5 md:p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-white"><Icons.Minus size={12}/></button>
                                                                <span className="w-6 md:w-8 text-center text-[10px] md:text-sm font-bold text-zinc-800 dark:text-white">{counters[k] || 0}</span>
                                                                <button onClick={() => { const v = (counters[k]||0)+1; setCounters(p=>({...p, [k]: v})); setSelectedItems(p=>({...p, [k]: true})); }} className="p-1.5 md:p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-white"><Icons.Plus size={12}/></button>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Right Column: Totals (Desktop Sticky) */}
                    <div className="lg:col-span-4 space-y-4">
                        <div className="hidden lg:block sticky top-24 space-y-4">
                            {/* Desktop Machine Value */}
                             <div className="glass-card p-6 rounded-2xl">
                                <label className="text-[10px] font-bold uppercase text-zinc-500 mb-2 block tracking-widest">Valor da Máquina</label>
                                <input type="text" value={machineValue} 
                                    onChange={e=>{ let v = e.target.value.replace(/\D/g, ''); if(!v) return setMachineValue(''); setMachineValue((parseInt(v)/100).toLocaleString('pt-BR', { minimumFractionDigits: 2 })); }} 
                                    className="w-full bg-white dark:bg-zinc-950/50 border border-zinc-300 dark:border-zinc-700 rounded-xl px-4 py-4 text-3xl font-mono font-bold text-zinc-900 dark:text-white focus:border-red-600 outline-none transition-colors text-right placeholder-zinc-400 dark:placeholder-zinc-700" 
                                    placeholder="0,00" />
                            </div>

                            {/* Desktop Totals */}
                            <div className="glass-card p-6 rounded-2xl border-l-4 border-l-red-600 bg-white dark:bg-gradient-to-br dark:from-zinc-900 dark:to-zinc-900">
                                <span className="text-[10px] font-bold uppercase text-zinc-500 tracking-widest">Total Cliente</span>
                                <div className="text-5xl font-heading font-bold text-zinc-900 dark:text-white mt-1 mb-4">{fmt(totals.normal)}</div>
                                <button onClick={()=>copy(totals.normal, 'normal')} 
                                    className="w-full py-3 bg-red-600 text-white font-bold text-xs uppercase rounded-xl hover:bg-red-500 transition-all shadow-lg shadow-red-900/20 active:translate-y-0.5 flex items-center justify-center gap-2">
                                    {copied === 'normal' ? <Icons.Check size={16}/> : <Icons.Copy size={16}/>}
                                    {copied === 'normal' ? 'Copiado!' : 'Copiar Cobrança'}
                                </button>
                            </div>

                            {isPartnershipAllowed && (
                                <div className="glass-card p-6 rounded-2xl border-l-4 border-l-blue-500 bg-white dark:bg-zinc-900/50">
                                    <span className="text-[10px] font-bold uppercase text-zinc-500 tracking-widest">Parceria</span>
                                    <div className="text-4xl font-heading font-bold text-blue-600 dark:text-blue-400 mt-1 mb-4">{fmt(totals.part)}</div>
                                    <button onClick={()=>copy(totals.part, 'part')} className="w-full py-3 bg-blue-500/10 text-blue-600 dark:text-blue-400 font-bold text-xs uppercase rounded-xl hover:bg-blue-500/20 transition-all border border-blue-500/20 active:translate-y-0.5">
                                        {copied === 'part' ? 'Copiado!' : 'Copiar Parceria'}
                                    </button>
                                </div>
                            )}

                            <button onClick={()=>{setMachineValue(''); setSelectedItems({}); setCounters({});}} 
                                className="w-full py-4 text-zinc-500 hover:text-red-500 font-bold text-[10px] uppercase tracking-widest transition-colors flex items-center justify-center gap-2">
                                <Icons.RefreshCw size={14}/> Resetar Calculadora
                            </button>
                        </div>
                    </div>

                    {/* Mobile Floating Bar */}
                    <div className="lg:hidden fixed bottom-0 left-0 right-0 glass border-t border-zinc-200 dark:border-white/10 z-[90] pb-safe">
                        <div className="p-3 space-y-2">
                             {/* Mobile Input */}
                             <div className="flex items-center gap-2 bg-zinc-100 dark:bg-zinc-900/80 p-1.5 rounded-xl border border-zinc-300 dark:border-white/5">
                                <span className="text-[9px] font-bold uppercase text-zinc-500 pl-2">MÁQ:</span>
                                <input type="text" value={machineValue} 
                                    onChange={e=>{ let v = e.target.value.replace(/\D/g, ''); if(!v) return setMachineValue(''); setMachineValue((parseInt(v)/100).toLocaleString('pt-BR', { minimumFractionDigits: 2 })); }} 
                                    className="bg-transparent w-full text-right text-sm font-mono font-bold text-zinc-900 dark:text-white outline-none mr-2" 
                                    placeholder="R$ 0,00" />
                            </div>

                            <div className="flex gap-2">
                                <div className="flex-1 bg-white dark:bg-zinc-800 rounded-xl p-2 flex flex-col justify-center border border-zinc-200 dark:border-white/5 relative overflow-hidden group" onClick={()=>copy(totals.normal, 'normal')}>
                                     <div className="absolute inset-0 bg-red-600/0 group-active:bg-red-600/10 transition-colors"/>
                                    <span className="text-[8px] font-bold uppercase text-zinc-500">Total</span>
                                    <span className="text-base font-heading font-bold text-zinc-900 dark:text-white leading-none">{fmt(totals.normal)}</span>
                                </div>
                                <button onClick={()=>copy(totals.normal, 'normal')} className="bg-red-600 text-white rounded-xl px-4 font-bold uppercase text-xs shadow-lg shadow-red-900/30 active:scale-95 transition-transform flex items-center justify-center">
                                    {copied === 'normal' ? <Icons.Check size={14}/> : 'Cobrar'}
                                </button>
                            </div>
                             {isPartnershipAllowed && (
                                <div className="flex justify-between items-center px-1">
                                    <span className="text-[9px] font-bold uppercase text-blue-600 dark:text-blue-400">Parceria: {fmt(totals.part)}</span>
                                    <button onClick={()=>copy(totals.part, 'part')} className="text-[8px] bg-blue-500/10 text-blue-600 dark:text-blue-400 px-2 py-0.5 rounded-full uppercase font-bold border border-blue-500/20">Copiar</button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ADMIN PANEL
        const AdminPanel = ({ user, isAdmin, currentData, isDarkMode }) => {
            const [pass, setPass] = useState('');
            const [data, setData] = useState(JSON.parse(JSON.stringify(currentData)));
            
            // Ordena chaves para exibição
            const sortedKeys = useMemo(() => {
                return Object.keys(data).sort((a, b) => (data[a].order ?? 0) - (data[b].order ?? 0));
            }, [data]);

            const [activeCategory, setActiveCategory] = useState(sortedKeys[0]);
            
            // Atualiza activeCategory se deletar
            useEffect(() => {
                if (!data[activeCategory] && sortedKeys.length > 0) setActiveCategory(sortedKeys[0]);
            }, [data, sortedKeys, activeCategory]);

            const [jsonMode, setJsonMode] = useState(false);
            const [jsonStr, setJsonStr] = useState(JSON.stringify(currentData, null, 2));
            const [msg, setMsg] = useState({t:'', e:false});
            const [isSaving, setIsSaving] = useState(false);

            const save = async () => {
                if(!isAdmin || isSaving || !db) return;
                setIsSaving(true); setMsg({t:'Gravando...', e:false});
                try {
                    const payload = jsonMode ? JSON.parse(jsonStr) : data;
                    await db.collection('artifacts').doc('redline-calc').collection('public').doc('vehicle_prices').set({config: payload});
                    setMsg({t:'Salvo com sucesso!', e:false});
                    setTimeout(()=>setMsg({t:'',e:false}), 3000);
                } catch(e) { setMsg({t:'Erro: '+e.message, e:true}); }
                setIsSaving(false);
            };

            const moveCategory = (key, direction) => {
                const keys = sortedKeys; // Usa as chaves já ordenadas
                const idx = keys.indexOf(key);
                if (idx < 0) return;
                const newIdx = idx + direction;
                if (newIdx < 0 || newIdx >= keys.length) return;
                
                const keyA = keys[idx];
                const keyB = keys[newIdx];
                const itemA = data[keyA];
                const itemB = data[keyB];

                // Troca os valores de ordem
                const orderA = itemA.order;
                const orderB = itemB.order;

                const newData = { ...data };
                newData[keyA] = { ...itemA, order: orderB };
                newData[keyB] = { ...itemB, order: orderA };
                
                setData(newData);
            };

            if(!isAdmin) return (
                <div className="flex items-center justify-center py-20 min-h-[60vh]">
                    <div className="glass-card p-8 rounded-3xl max-w-sm w-full text-center border-t border-white/20">
                        <div className="w-20 h-20 bg-red-600/10 rounded-2xl flex items-center justify-center mx-auto mb-6 text-red-500 shadow-xl shadow-red-900/10">
                            <Icons.Settings size={36}/>
                        </div>
                        <h2 className="text-2xl font-heading font-bold text-zinc-900 dark:text-white mb-2">Área Restrita</h2>
                        <p className="text-xs text-zinc-500 mb-8 font-medium">Faça login para gerenciar os preços.</p>
                        <form onSubmit={(e)=>{e.preventDefault(); auth.signInWithEmailAndPassword('redlinemec2023@gmail.com', pass).catch(()=>setMsg({t:'Acesso Negado.', e:true}))}} className="space-y-4">
                            <div className="relative group">
                                <input type="password" value={pass} onChange={e=>setPass(e.target.value)} className="w-full bg-zinc-100 dark:bg-black/30 border border-zinc-300 dark:border-zinc-700 p-4 rounded-xl text-zinc-900 dark:text-white outline-none focus:border-red-600 transition-colors pl-4" placeholder="Senha Mestra" />
                            </div>
                            {msg.t && <p className={`text-xs font-bold ${msg.e ? 'text-red-500' : 'text-green-500'}`}>{msg.t}</p>}
                            <button className="w-full bg-red-600 text-white font-bold py-4 rounded-xl uppercase tracking-widest text-xs hover:bg-red-500 transition-all shadow-lg shadow-red-900/20 active:translate-y-0.5">Entrar no Painel</button>
                        </form>
                    </div>
                </div>
            );

            const current = data[activeCategory];

            return (
                <div className="flex flex-col lg:flex-row gap-8 min-h-[80vh] pb-24">
                     {/* Sidebar Navigation */}
                    <aside className="lg:w-64 flex-shrink-0">
                        <div className="glass-card rounded-2xl p-4 sticky top-24">
                            <h2 className="text-[10px] font-bold text-zinc-400 uppercase tracking-widest mb-4 px-2">Categorias</h2>
                            <div className="flex flex-col gap-2">
                                {sortedKeys.map((k, idx, arr) => (
                                    <div key={k} className={`flex items-center gap-1 p-1 rounded-xl transition-all ${activeCategory === k ? 'bg-red-600 text-white shadow-lg shadow-red-900/20' : 'hover:bg-zinc-100 dark:hover:bg-zinc-800'}`}>
                                        <button onClick={() => setActiveCategory(k)} className={`flex-grow text-left px-3 py-2 text-xs font-bold uppercase whitespace-nowrap overflow-hidden text-ellipsis ${activeCategory === k ? 'text-white' : 'text-zinc-500 dark:text-zinc-400'}`}>
                                            {data[k].title}
                                        </button>
                                        <div className="flex flex-col gap-0.5 pr-1">
                                            <button onClick={()=>moveCategory(k, -1)} disabled={idx===0} className="p-0.5 hover:text-white disabled:opacity-30"><Icons.ArrowUp size={10}/></button>
                                            <button onClick={()=>moveCategory(k, 1)} disabled={idx===arr.length-1} className="p-0.5 hover:text-white disabled:opacity-30"><Icons.ArrowDown size={10}/></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <button onClick={()=>{const n = prompt("Novo Menu:"); if(n){const k=n.toLowerCase().replace(/\s+/g,'_'); const newOrder = sortedKeys.length; setData({...data,[k]:{order: newOrder, title:n.toUpperCase(),partnershipEnabled:true,discountValue:5000,sections:[]}}); setActiveCategory(k);}}} className="mt-4 w-full py-3 border-2 border-dashed border-zinc-300 dark:border-zinc-700 rounded-xl text-zinc-500 hover:border-red-500 hover:text-red-500 transition-colors uppercase text-[10px] font-bold">
                                + Nova Categoria
                            </button>
                        </div>
                    </aside>

                    {/* Main Content Area */}
                    <div className="flex-grow space-y-6">
                        {/* Sticky Toolbar */}
                        <div className="glass-card p-3 rounded-2xl flex flex-wrap gap-4 items-center justify-between sticky top-20 z-40 backdrop-blur-xl border border-white/50 dark:border-white/5 shadow-lg shadow-black/5">
                             <div className="flex items-center gap-2">
                                <button onClick={()=>setJsonMode(false)} className={`px-4 py-2 rounded-lg text-[10px] font-bold uppercase transition-all ${!jsonMode ? 'bg-zinc-800 text-white shadow' : 'text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800'}`}>Visual</button>
                                <button onClick={()=>{setJsonStr(JSON.stringify(data, null, 2)); setJsonMode(true)}} className={`px-4 py-2 rounded-lg text-[10px] font-bold uppercase transition-all ${jsonMode ? 'bg-zinc-800 text-white shadow' : 'text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800'}`}>JSON</button>
                            </div>
                            <div className="flex items-center gap-3">
                                {msg.t && <span className={`text-xs font-bold px-3 py-1 rounded bg-zinc-100 dark:bg-zinc-900 ${msg.e ? 'text-red-500' : 'text-green-500'}`}>{msg.t}</span>}
                                <button onClick={save} disabled={isSaving} className="bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all flex items-center gap-2 shadow-lg shadow-green-900/20 active:translate-y-0.5">
                                    {isSaving ? <Icons.Spinner size={14}/> : <Icons.Save size={14}/>} Salvar
                                </button>
                                <button onClick={()=>auth.signOut()} className="bg-zinc-200 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 p-2 rounded-lg hover:text-red-500 transition-colors" title="Sair"><Icons.LogOut size={16}/></button>
                            </div>
                        </div>

                        {jsonMode ? (
                            <textarea value={jsonStr} onChange={e=>setJsonStr(e.target.value)} className="w-full h-[65vh] bg-zinc-100 dark:bg-zinc-950 p-6 rounded-2xl border border-zinc-300 dark:border-zinc-800 font-mono text-xs text-zinc-600 dark:text-green-500 outline-none leading-relaxed shadow-inner" spellCheck="false" />
                        ) : (
                            <div className="space-y-6 animate-fade">
                                {/* Category Settings Card */}
                                <div className="glass-card p-6 rounded-2xl">
                                    <h3 className="text-xs font-bold text-zinc-400 uppercase tracking-widest mb-4 border-b border-zinc-200 dark:border-white/5 pb-2">Configurações da Categoria</h3>
                                    <div className="flex flex-col gap-4">
                                        <div className="group">
                                            <label className="text-[10px] uppercase font-bold text-zinc-500 mb-1.5 block group-focus-within:text-red-500 transition-colors">Título da Aba</label>
                                            <input type="text" value={current.title} onChange={e=>{const n={...data}; n[activeCategory].title=e.target.value.toUpperCase(); setData(n);}} className="w-full bg-zinc-50 dark:bg-zinc-950/50 border border-zinc-200 dark:border-zinc-700 rounded-xl px-3 py-3 text-sm text-zinc-900 dark:text-white font-bold outline-none focus:border-red-500 transition-colors" />
                                        </div>
                                        <div className="group">
                                            <label className="text-[10px] uppercase font-bold text-zinc-500 mb-1.5 block group-focus-within:text-red-500 transition-colors">Desconto Parceria</label>
                                            <input type="text" value={(current.discountValue || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})} onChange={e=>{const val = parseInt(e.target.value.replace(/\D/g, '')) || 0; const n={...data}; n[activeCategory].discountValue=val; setData(n);}} className="w-full bg-zinc-50 dark:bg-zinc-950/50 border border-zinc-200 dark:border-zinc-700 rounded-xl px-3 py-3 text-lg text-zinc-900 dark:text-white font-mono font-bold outline-none focus:border-red-500 transition-colors" />
                                        </div>
                                        <div className="flex items-center pt-2">
                                            <label className="flex items-center gap-3 cursor-pointer p-2 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800/50 w-full transition-colors">
                                                <input type="checkbox" checked={current.partnershipEnabled !== false} onChange={e=>{const n={...data}; n[activeCategory].partnershipEnabled=e.target.checked; setData(n);}} className="w-5 h-5 accent-red-600 rounded" />
                                                <span className="text-xs font-bold text-zinc-600 dark:text-zinc-300">Ativar Parceria nesta categoria</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                {/* Sections List */}
                                <div className="space-y-4">
                                    {current.sections.map((sec, sIdx) => (
                                        <div key={sIdx} className="glass-card rounded-2xl overflow-hidden border border-zinc-200 dark:border-white/5 shadow-sm group/section">
                                            {/* Section Header */}
                                            <div className="bg-zinc-50 dark:bg-zinc-900/40 p-4 border-b border-zinc-200 dark:border-white/5 flex flex-wrap items-center gap-4">
                                                <div className="p-2 bg-zinc-200 dark:bg-zinc-800 rounded-lg text-zinc-500">
                                                    <Icons.Check size={16}/>
                                                </div>
                                                <div className="flex-grow min-w-[200px]">
                                                    <label className="text-[9px] uppercase font-bold text-zinc-400 block mb-0.5">Nome da Seção</label>
                                                    <input type="text" value={sec.name} onChange={e=>{const n={...data}; n[activeCategory].sections[sIdx].name=e.target.value.toUpperCase(); setData(n);}} className="bg-transparent text-sm font-bold text-zinc-900 dark:text-white uppercase outline-none w-full placeholder-zinc-500" placeholder="EX: MOTOR" />
                                                </div>
                                                <label className="flex items-center gap-2 cursor-pointer bg-zinc-100 dark:bg-black/20 px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-white/5">
                                                    <input type="checkbox" checked={sec.enableSelectAll !== false} onChange={e=>{const n={...data}; n[activeCategory].sections[sIdx].enableSelectAll=e.target.checked; setData(n);}} className="accent-red-600 w-4 h-4" />
                                                    <span className="text-[10px] font-bold text-zinc-500 uppercase">Permitir 'Selecionar Todos'</span>
                                                </label>
                                                <button onClick={()=>{const n={...data}; n[activeCategory].sections.splice(sIdx,1); setData(n);}} className="p-2 text-zinc-400 hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-colors" title="Excluir Seção"><Icons.Trash size={18}/></button>
                                            </div>
                                            
                                            {/* Items Container */}
                                            <div className="p-2">
                                                <div className="space-y-1">
                                                    {sec.items.map((item, iIdx) => (
                                                        <div key={iIdx} className="group flex items-center gap-3 p-2 rounded-xl hover:bg-zinc-100 dark:hover:bg-zinc-800/40 border border-transparent hover:border-zinc-200 dark:hover:border-white/5 transition-all">
                                                            {/* Item Name */}
                                                            <div className="flex-grow flex flex-col">
                                                                <input type="text" value={item.name} onChange={e=>{const n={...data}; n[activeCategory].sections[sIdx].items[iIdx].name=e.target.value; setData(n);}} className="bg-transparent text-sm font-bold text-zinc-700 dark:text-zinc-300 w-full outline-none placeholder-zinc-500" placeholder="Nome do Item" />
                                                            </div>
                                                            
                                                            {/* Item Value */}
                                                            <div className="relative">
                                                                <span className="absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-zinc-400">R$</span>
                                                                <input type="text" value={(item.value).toLocaleString('pt-BR', {minimumFractionDigits: 2})} 
                                                                    onChange={e=>{
                                                                        const val = parseInt(e.target.value.replace(/\D/g, '')) || 0;
                                                                        const n={...data}; n[activeCategory].sections[sIdx].items[iIdx].value=val; setData(n);
                                                                    }} 
                                                                    className="bg-white dark:bg-zinc-950 w-40 pl-8 pr-3 py-2 text-right text-lg font-mono font-bold text-zinc-800 dark:text-white rounded-lg border border-zinc-200 dark:border-zinc-800 outline-none focus:border-zinc-400 dark:focus:border-zinc-600 transition-colors shadow-sm" placeholder="0,00" />
                                                            </div>

                                                            {/* Delete Item */}
                                                            <button onClick={()=>{const n={...data}; n[activeCategory].sections[sIdx].items.splice(iIdx,1); setData(n);}} className="p-2 text-zinc-400 hover:text-red-500 transition-colors"><Icons.Trash size={16}/></button>
                                                        </div>
                                                    ))}
                                                </div>
                                                
                                                <button onClick={()=>{const n={...data}; n[activeCategory].sections[sIdx].items.push({name:'NOVO ITEM', value:0}); setData(n);}} className="mt-2 w-full py-3 text-[10px] font-bold uppercase text-zinc-500 hover:text-zinc-900 dark:hover:text-white bg-zinc-50 dark:bg-zinc-900/30 rounded-lg border border-dashed border-zinc-300 dark:border-zinc-800 hover:border-zinc-400 dark:hover:border-zinc-600 transition-all">+ Adicionar Item</button>
                                            </div>
                                        </div>
                                    ))}
                                    
                                    <button onClick={()=>{const n={...data}; n[activeCategory].sections.push({name:'NOVA SEÇÃO', items:[]}); setData(n);}} className="w-full py-6 rounded-2xl border-2 border-dashed border-zinc-300 dark:border-zinc-800 text-zinc-400 hover:text-red-500 hover:border-red-500/50 hover:bg-red-500/5 transition-all flex flex-col items-center justify-center gap-2 group">
                                        <div className="p-2 bg-zinc-200 dark:bg-zinc-800 rounded-full group-hover:bg-red-500 group-hover:text-white transition-colors">
                                            <Icons.Plus size={20}/>
                                        </div>
                                        <span className="text-xs font-bold uppercase tracking-widest">Criar Nova Seção</span>
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>